
@{
    ViewBag.Title = "Certificate";
}

<style>
    .btn-primary:hover, .btn-primary:active, .btn-primary:focus, .btn-primary:active:focus, .btn-primary:active:hover {
        background-color: #008888;
        color: #fff !important;
        border-color: #008888;
    }

    .btn-primaryred, .btn-primaryred:active, .btn-primaryred:focus, .btn-primaryred:active:focus, .btn-primaryred:active:hover {
        background-color: transparent;
        border-color: #C00505;
        color: #C00505 !important;
        font-size: 12px;
        width: 72px;
    }
        .btn-primaryred:hover {
            background-color: #C00505;
            color: #fff !important;
            border-color: #C00505;
        }

    .btn-success {
        color: #fff;
        background-color: #628fb3;
        border: none;
        font-size: 12px !important;
    }

        .btn-success:hover, .btn-success:active, .btn-success:focus, .btn-success:active:focus, .btn-success:active:hover {
            color: #fff;
            background-color: #628fb3;
            border: none;
        }
    .btn-right {
        background-image: url('../../image/Button/right.png');
        background-size: contain;
        background-repeat: no-repeat;
        border: none;
        background-color: transparent;
        box-shadow: none;
    }

        .btn-right:hover {
            background-image: url('../../image/Button/righthover.png');
            background-size: contain;
            background-repeat: no-repeat;
            border: none;
            background-color: transparent !important;
            box-shadow: none;
        }

    .btn-left {
        background-image: url('../../image/Button/left.png');
        background-size: contain;
        background-repeat: no-repeat;
        border: none;
        background-color: transparent !important;
        box-shadow: none;
    }

        .btn-left:hover {
            background-image: url('../../image/Button/lefthover.png');
            background-size: contain;
            background-repeat: no-repeat;
            border: none;
            background-color: transparent !important;
            box-shadow: none;
        }

    .btn-center {
        background-image: url('../../image/Button/center.png');
        background-size: contain;
        background-repeat: no-repeat;
        border: none;
        background-color: transparent !important;
        box-shadow: none;
    }

        .btn-center:hover {
            background-image: url('../../image/Button/centerhover.png');
            background-size: contain;
            background-repeat: no-repeat;
            border: none;
            background-color: transparent !important;
            box-shadow: none;
        }

    .content_vendor {
    }

    .col-md-3 label {
        width: 25%;
    }

    .nbut {
        width: 300px;
        font-weight: initial;
        margin-top: 20px;
        height: 38px;
    }

    .minusbutton {
        border: none;
        background: transparent;
        outline: none;
        padding: initial;
    }

    .money {
        width: 120px;
        display: inline;
        text-align: right;
    }

    #footer {
        position: fixed;
        right: 1rem;
        bottom: 0px;
        width: 100%;
        text-align: center;
        color: #fff;
        background: rgba(90,92,105,.5);
        line-height: 46px;
        display: inline;
    }

    .italic {
        font-style: italic;
    }

    .redtext {
        color: red;
    }

    .logo img {
        width: 250px;
    }

    .header_title {
        text-align: center;
        text-transform: uppercase;
        color: #fff;
        font-size: 22px;
        font-weight: bold;
    }

    .header_vender {
        background-color: #868686;
        padding: 18px 0px;
    }

    .text_home {
        float: right;
        margin-top: 18px;
    }

        .text_home a {
            font-size: 12px;
            color: #fff;
        }

    legend {
        display: block;
        width: 100%;
        padding: 0;
        margin-bottom: 10px;
        margin-top: 32px;
        font-size: 22px;
        line-height: inherit;
        color: #658EC6;
        text-transform: uppercase;
        border: 0;
    }

    .label2 {
        display: block;
        width: 100%;
        padding: 0;
        font-size: 15px;
        line-height: inherit;
        color: #658EC6;
        text-transform: uppercase;
        border: 0;
    }

    fieldset {
        margin-top: 34px;
    }

    label {
        font-size: 12px;
        color: #59595B;
    }

    .from_vender {
        margin-left: 8px;
    }

        .from_vender input, .from_vender select {
            margin-bottom: 8px;
        }

    .button_save_1 {
        margin-right: 16px;
        margin-top: 20px;
        width: 331px;
    }

        .button_save_1 a {
            text-align: center;
            background-color: #868686 !important;
            border-color: #868686 !important;
            font-size: 12px;
            font-weight: bold;
            padding-top: 8px;
        }

    #E_Invoice {
        margin-bottom: 18px !important;
    }

    hr {
        margin-top: 20px;
        margin-bottom: 20px;
        border: 0;
        border-top: 1px solid #868686;
        width: 90%;
    }

    .button_save_1 a:hover {
        text-decoration: none;
    }

    .btn-primary {
        background-color: #86868600;
        border-color: #868686;
        color: #6f8cb8 !important;
    }

    .button_action a:hover {
        background-color: #9e9e9e;
        color: #f3f3f3 !important;
    }

    .button_action a {
        text-align: center;
        font-size: 12px;
        height: 42px;
        padding: 12px 12px;
        font-weight: bold;
    }

    .button_action {
        margin-top: 40px;
        margin-bottom: 40px;
    }

    .table > thead > tr {
        background: #C4C4C4;
    }

        .table > thead > tr > th {
            color: #59595B;
            font-size: 12px !important;
        }

    .table > tbody > tr > td {
        padding: 2px;
        color: #59595B !important;
        font-size: 12px !important;
        vertical-align: middle;
    }
</style>
<style>

    html {
        height: 100%;
        box-sizing: border-box;
    }

    *,
    *:before,
    *:after {
        box-sizing: inherit;
    }

    body {
        position: relative;
        background-image: url('../../image/nen2.jpg');
        background-color: #f3f3f3;
        background-size: cover;
    }

    .ct {
        margin: 0 auto;
        padding-top: 32px;
    }

    .demo h1 {
        margin-top: 0;
    }

    /**
    * Footer Styles
    */

    .footer {
        position: absolute;
        right: 0;
        bottom: 0;
        left: 0;
        /* padding: 1rem;*/
        background-color: #efefef;
        text-align: center;
    }
</style>

<div class="wp_vendor">
    @Html.Partial("~/Views/Shared/_header.cshtml")
    <div class="content_vendor ct">
        <div class="container">

            <div class="row from_vender">
                <div class="row" style="margin-top:20px; margin-bottom:40px"> 
                    <div class="col-md-12">

                        <div class="col-md-12">
                            <span style="font-weight:bold">Tên sản phẩm:</span>
                            <span>@ViewBag.Productname</span>
                        </div>
                       
                            
                        
                    </div>
                </div>

                <div class="row_3">


                    <table id="tbl_leadtime" class="table table-bordered">
                        <thead>
                            <tr>
                                <th scope="col" style="text-align: center; width:50%">
                                    Nhập mô tả (nếu có)
                                </th>
                                <th scope="col" style="text-align: center; width:35%">
                                    File
                                </th>
                                <th scope="col" style="text-align: center; width:15%">
                                    Thao tác
                                </th>
                            </tr>
                        </thead>
                        <tbody></tbody>
                        <tfoot>
                            <tr>
                                <td>
                                    <input type="text" class="form-control" id="txtDes" />
                                </td>
                                <td>


                                    <form id="ExcelUpload">
                                        <div class="row">
                                            <div class="col-md-8 col-xs-6">

                                                @*<button type="button" class="btn btn-success" onclick="UploadExcel()" style="background-color: #A45D41 !important;border-color: #A45D41 !important;"><i class="fa fa-upload" aria-hidden="true"></i> Upload file</button>*@
                                            </div>
                                            <div class="col-md-4 col-xs-6">
                                                <input type="file" style="width: 0.1px;height: 0.1px;opacity: 0;overflow: hidden;position: absolute;z-index: -1;" id="ExcelFileUpload" class="inputfile">
                                                <label class="btn btn-success" for="ExcelFileUpload" style="width: 100%;margin-bottom:10px;"><i class="fa fa-file-excel-o" aria-hidden="true"></i>Chọn file</label>
                                                <span style="color:red;font:bolder;float:left; visibility:hidden" id="fileErrorMessage"></span>
                                            </div>
                                        </div>
                                    </form>
                                </td>
                                <td >
                                    <input type="text" class="form-control hidden" id="txtLeadtime" onchange="intNumberParse('txtLeadtime')" value="0" />
                                </td>
                                <td style="text-align: center;" class="hidden">
                                    @*<input type="button" class="form-control btn-primary" id="btnAddLeadtime" onclick="addRow()" />*@
                                    <a href="#" onclick="addRow()" class="btn btn-success bt_action"><i class="fa fa-plus-circle" aria-hidden="true"></i> Thêm</a>
                                </td>
                            </tr>
                        </tfoot>
                    </table>

                </div>
                <div class="clearfix"></div>
                <div class="row_4 button_action">
                   
                    <div class="col-md-7" style="margin-top:-55px">
                        <input type="checkbox" id="mustcheck" style="margin-left: -17px;" />
                        <span>
                            Bằng việc hoàn tất tải lên file hồ sơ và nhấn nút Xác nhận tại trang web này, Quý đối tác đã xác nhận những thay đổi để áp dụng cho quá trình hợp tác với Bibo Mart và hoàn toàn chịu trách nhiệm về tính chính xác của những thông tin này.
                        </span>
                    </div>
                    <div class="col-md-1"></div>
                    <div class="col-md-4">
                        <a href="#" class="form-control btn-center" onclick="Save()"><i class="fa fa-floppy-o" aria-hidden="true"></i> @MP_VendorTool.Resource.Save_Con</a>
                    </div>
                </div>
                </div>
        </div>
    </div>
</div>

<script type="text/javascript" src="https://ajax.googleapis.com/ajax/libs/jquery/1.8.3/jquery.min.js"></script>
<script type="text/javascript" src="https://ajax.cdnjs.com/ajax/libs/json2/20110223/json2.js"></script>
<script type="text/javascript">
    $(document).ready(function () {
        $('#header_title').html('Cập nhật dữ liệu sản phẩm');
    });



    function Save() {
        if (!$('#mustcheck').is(":checked")) {
            alert("Nhấn vào ô chọn để tiếp tục");
            return;
        }
        var arrLeadTime = new Array();

        $("#tbl_leadtime TBODY TR").each(function () {

            var row = $(this);
            var item_obj = {};

            item_obj.attributeName = row.find("TD").eq(0).html();

            item_obj.link = row.find("TD").eq(1).html();

            arrLeadTime.push(item_obj);
        });

        console.log(JSON.stringify(arrLeadTime));


        $.ajax({
            type: "POST",
            url: "/Vendor/cert_Save",
            data: '{token:"@ViewBag.token",ls_cer:' + JSON.stringify(arrLeadTime) + '}',
            contentType: "application/json; charset=utf-8",
            dataType: "json",
            success: function (r1) {

                if (r1.code == '0') {
                    //alert(r1.message);
                    window.location.href = '/Home/Index';
                } else if (r1.code == '2')
                {
                    alert(r1.message);
                } else {
                    alert("Có lỗi xảy ra thử lại sau!");
                }
            }
        });
    }

    function Remove(button) {
        //Determine the reference of the Row using the Button.
        var row = $(button).closest("TR");
        var name = $("TD", row).eq(0).html();
        if (confirm("Xóa: " + name + " ?")) {
            //Get the reference of the Table.
            var table = $("#tbl_leadtime")[0];

            //Delete the Table row using it's Index.
            table.deleteRow(row[0].rowIndex);
        }
    };

    //Upload file
    $(document).ready(function () {
        //validating uploaded file whether it is Excel or not while uploading
        $("#ExcelFileUpload").change(function () {
            fileErrorMessage.innerHTML = '';
            var vtrUpload = $("#ExcelFileUpload").val().toLowerCase();
            var regexVTRUpload = new RegExp("(.*?)\.(xlsx|xls)$");
            //if (!(regexVTRUpload.test(vtrUpload))) {
            //    $("#ExcelFileUpload").val("");
            //    //fileErrorMessage.innerHTML = 'Please select .xls or .xlsx files';
            // ViewBagBag  alert("file false");
            //} else {
            //alert("2222222222222222");
            var fz = parseFloat(this.files[0].size / 1024 / 1024);
            console.log('This file size is: ' + this.files[0].size / 1024 / 1024 + "MiB");

            if (fz < 6) {
                UploadExcel();
            } else {
                alert("Chọn file dưới 6MB");
            }


            //}
        });
    });

    function UploadExcel()
    {
        var formdata = new FormData(); //FormData object
        var fileInput = document.getElementById('ExcelFileUpload');
        var filename = fileInput.files[0].name
        var extension = filename.split('.').pop().toUpperCase();

        for (i = 0; i < fileInput.files.length; i++) {
            formdata.append(fileInput.files[i].name, fileInput.files[i]);
        }

        $('#div_load').css("visibility", "inherit");

        $.ajax({
            url: '@Url.Action("cer_Upload", "Vendor")', //ReadExcelFile is a Action Name and ExcelUpload is Controller name
            type: 'POST',
            data: formdata, // Posting the uploaded excel file to controller
            //async: true,
            success: function (data) {

                //var sub = JSON.parse(data);

                //$('html,body').scrollTop(0);

                console.log(JSON.stringify(data));

                if (data.code == "1") {

                    var tBody = $("#tbl_leadtime > TBODY")[0];

                    //Add Row.
                    var row = tBody.insertRow(-1);

                    //Add Type cell
                    cell = $(row.insertCell(-1));
                    cell.html($('#txtDes').val());

                    //Add Type cell
                    cell = $(row.insertCell(-1));
                    cell.html(data.link);


                    //Add Button cell.
                    cell = $(row.insertCell(-1));
                    cell.append('<p style="text-align:center;"><a href="#"  onclick="Remove(this);" class="btn btn-warning bt_action_delete btn-primaryred"><i class="fa fa-trash" aria-hidden="true"></i> Xóa</a></p>');

                    //Clear the TextBoxes.
                    $('#txtDes').val("");
                    $('#ExcelFileUpload').val("");

                    //alert(data.message);

                } else {
                    alert(data.message);
                }
            },
            cache: false,
            contentType: false,
            processData: false
        });
    }

</script>



