@using System.Data
<div class="table-responsive">
    <table id="tbl_Item" class="table table-striped table-bordered table-hover" cellspacing="0" width="100%">
        <thead>
            <tr style=" height: 35px;">
                <th class="text-left" >
                    Mã Hàng
                </th>
                <th class="text-left" style="width: 200px; max-width: 200px; ">
                    Tên hàng
                </th>
                <th class="text-left" >
                    Giá trước <br />thay đổi - VAT
                </th>
                <th class="text-left">
                    Xác nhận giá<br /> sau thay đổi - VAT
                </th>
                <th class="text-left" >
                    Ngày bắt<br /> đầu
                </th>
                <th class="text-left" >
                    Ngày kết<br /> thúc
                </th>
                <th class="text-left" >
                    Ngày gửi duyệt
                </th>
                <th class="text-center" style="width: 150px; max-width: 150px; ">
                    Trạng thái
                </th>
                <th class="text-center" >
                    Chi tiết
                </th>
                <th class="text-center" >
                    Người duyệt
                </th>
                <th class="text-center" >
                    Ngày duyệt
                </th>
                <th class="text-center" >
                    Lý do<br />
                    từ chối
                </th>
                <th class="text-center" style="width: 88px; max-width: 88px; ">
                    Hành động
                </th>
            </tr>
        </thead>
        <tbody>
            @{
                if (Model != null)
                {
                    var dt = Model as DataTable;
                    if (dt.Rows.Count > 0)
                    {
                        var i = 0;
                        foreach (DataRow item in dt.Rows)
                        {
                        <tr id="row_@i">
                            <td class="text-left">
                                @item["MaHang"]
                            </td>
                            <td class="text-left" style="width: 200px; max-width: 200px; overflow: hidden; white-space: nowrap " title="@item["TenHang"]">
                                @item["TenHang"]
                            </td>
                            <td class="text-right">
                                @item["GiaTruocThayDoi"]
                            </td>
                            <td class="text-right" style="text-align: center; width: 130px; max-width: 130px; overflow: hidden; white-space: nowrap ">
                                @if (@item["TrangThai"].ToString() == "1" || @item["TrangThai"].ToString() == "3")
                                {
                                    @item["GiaSauThayDoi"]
                                    @*<input name="GiaSauThayDoi" disabled id="GiaSauThayDoi_@i" value="@item["GiaSauThayDoi"]" onchange="GiaSauThayDoi_Change('@item["ID"]','@i')" class="form-control OrderValue" style="box-shadow: none;background-color:#fff" />*@
                                }
                                else
                                {
                                    <input name="GiaSauThayDoi" id="GiaSauThayDoi_@i" value="@item["GiaSauThayDoi"]" onchange="GiaSauThayDoi_Change('@item["ID"]','@i')" class="form-control OrderValue" style="box-shadow: none;text-align:right; background-color:#fff" />
                                }
                            </td>
                            <td class="text-right">
                                @item["ToDay"]
                            </td>
                            <td class="text-right">
                                @item["FromDay"]
                            </td>
                            <td class="text-right">
                                @item["NgayGuiDuyet"]
                            </td>
                            <td class="text-center">
                                @Html.Raw(item["Status"])
                            </td>
                            <td class="text-center">
                                <a onclick="load('@item["ID"]')" class="btn btn-primary btn-xs" style=" color:#fff">Chi tiết</a>
                            </td>
                            <td class="text-right">
                                @item["ModifyBy"]
                            </td>
                            <td class="text-right">
                                @item["ModifyDate"]
                            </td>
                            <td class="text-left" style="text-align: center; width: 130px; max-width: 130px; overflow: hidden; white-space: nowrap " title="@item["LyDoTuChoi"]">
                                @Html.Raw(item["LyDoTuChoi"])
                            </td>
                            <td class="text-center " id="CheckID" style="width: 88px; max-width: 88px; ">
                                @*@item["DeXuat"]*@
                                <span style="display:none" id="DeXuat_@i">@item["DeXuat1"]</span>
                                @{
                                    if (@item["TrangThai"].ToString() == "1" || @item["TrangThai"].ToString() == "3" || @item["TrangThai"].ToString() == "2")
                                    {
                                        <input type="checkbox" disabled name="CheckID" value="@item["ID"]" />
                                    }
                                    else
                                    {
                                        <input type="checkbox" id="_@i" onchange="clearcheck(@i)" name="CheckID" value="@item["ID"]" />
                                    }
                                }
                            </td>
                        </tr>
                            i++;
                        }
                    }
                }
            }
        </tbody>
        <tfoot>
        </tfoot>
    </table>
    </div>
    <script>
        function GiaSauThayDoi_Change(ID, i) {
            let GiaSauThayDois = String($('#row_' + i + ' input[name="GiaSauThayDoi"]').val()).trim();
            // alert(GiaSauThayDois);
            var Price = GiaSauThayDois.replaceAll(',', '').replaceAll('.', '');
            if (Price.length > 0) {
                $.ajax({
                    type: "POST",
                    url: '/OfferPrice/Update_GiaSauThayDoi_OfferPrice',
                    data: JSON.stringify({ ID: ID, Price: Price }),
                    contentType: "application/json; charset=utf-8",
                    dataType: "json",
                    success: function (rt) {
                        if (rt.code == 0) {
                            js_GetList();
                        }
                    }
                });
            }
        }
        function clearcheck(k) {
            var cboxes = document.getElementsByName('CheckID');
            for (var i = 0; i < cboxes.length; i++) {
                if (cboxes[i].checked) {
                    cboxes[i].checked = false;
                }
            }
            $("#_" + k).prop('checked', true);
        }
    </script>

