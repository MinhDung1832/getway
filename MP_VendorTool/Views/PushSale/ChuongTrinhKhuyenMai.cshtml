@using MP_VendorTool.Common;
@using MP_VendorTool.Models.Order
@{
    var serializer = new System.Web.Script.Serialization.JavaScriptSerializer();
    serializer.MaxJsonLength = Int32.MaxValue;
    var jsonItems = serializer.Serialize(ViewBag.lstItem);
}
@{
    ViewBag.Title = "Quản lý chương trình Push Sale NCC";
    Layout = "~/Views/Shared/_Layout.cshtml";
}
<link href="~/Content/maincontent.css" rel="stylesheet" />

<style>
    label {
        font-weight: 400 !important;
    }

        label.col-sm-4.col-form-label {
            padding-top: 5px;
        }

    .OrderValue {
        text-align: right
    }

    select.form-control {
        padding: 1px 12px 3px 3px;
    }

    .btn_add a {
        padding: 3px 16px !important;
        background-color: #ffffff !important;
        color: #337ab7 !important;
    }

    .dropdown.bootstrap-select.form-control.bs3.disabled {
        background: #f9f9f9 !important;
    }

    #btn_Gui {
        background-color: #868686;
        color: #fff;
        padding: 3px 21px;
        margin-top: 2px;
        width: 120px;
        text-align: left;
        font-size: 13px;
    }

    .btn_detail {
        padding: 1px 1px;
        color: #525252;
        font-size: 11px;
        border-radius: 69px;
        border: 1px solid #ffffff;
    }

    button.btn.dropdown-toggle.btn-default {
        padding: 6px 10px 0px !important;
    }

    .bootstrap-select .dropdown-toggle .filter-option-inner-inner {
        color: #59595B;
    }

    .bootstrap-select .dropdown-toggle .filter-option-inner-inner {
        overflow: hidden;
        height: 17px;
        padding: 0px;
    }

    .dropdown.bootstrap-select.form-control {
        padding: 0px;
        margin: 0px;
        background: none;
        width: 280px;
        max-width: 287px;
        padding-left: 0px !important;
        border: none !important;
    }

    .col-sm-8 .btn {
        height: 27px;
        line-height: 13px;
    }

    .box_loaihinh .form-check {
        display: inline-block;
        padding: 3px 3%;
    }

    .box_loaihinh {
        padding-top: 15px;
        padding-bottom: 15px;
    }

        .box_loaihinh label {
            font-size: 14px !important
        }

    input, select, textarea {
        max-width: 288px;
    }

    .btn-info {
        padding: 4px !important;
        text-align: left;
        max-width: 150px;
        border: none;
    }

    #tbl_Item {
        margin-top: 18px;
        font-size: 12px;
    }

    .content_search label {
        font-size: 13px;
        text-align: left !important;
        padding-top: 6px;
    }

    .btn-info:hover {
        color: #fff;
        background-color: #868686;
        border-color: #868686;
    }

    .btn:hover, .btn:focus, .btn.focus {
        color: #fff;
        background-color: #868686;
        border-color: #868686;
    }

    .wp_hearder {
        padding: 5px 0px;
        background-color: #868686;
        position: fixed;
        z-index: 999;
        top: 0;
        height: 65px !important;
        width: 100%;
    }

    .card-body {
        width: 100%;
        text-align: center;
        margin-left: 1%;
        margin-top: 0px;
    }

    .content {
        -webkit-transition: all .4s ease-in-out;
        -moz-transition: all .4s ease-in-out;
        -o-transition: all .4s ease-in-out;
        -ms-transition: all .4s ease-in-out;
    }

    .btn_search {
        background-color: #868686;
        color: #fff;
        width: 100%;
        height: 23px;
        margin-bottom: 4px;
        padding: 2px 19px !important;
        text-align: left;
        font-size: 12px;
    }

    .wp_table {
        padding-top: 134px;
    }

    body {
        font-size: 12px;
    }

    .wp_table {
        width: 90%;
        margin: 0 auto;
    }

    .logo img {
        width: 250px;
    }

    .header_title {
        text-align: center;
        text-transform: uppercase;
        color: #fff;
        font-size: 28px;
        font-weight: bold;
    }

    .header_vender {
        background-color: #868686;
        padding: 18px 0px;
    }

    table.dataTable.no-footer {
        border-bottom: 1px solid #bdbdbd !important;
    }

    .text_home {
        float: right;
        margin-top: 14px;
    }

        .text_home a {
            font-size: 18px;
            color: #fff;
            font-weight: bold;
        }

    .content_search .form-group {
        margin-bottom: 1px !important;
    }

    .content_search .form-control {
        height: 25px !important;
        padding: 0px 0px !important;
    }

    table.dataTable tbody th, table.dataTable tbody td {
        padding: 3px 10px !important;
    }

    #tbl_Item tbody {
        background-color: #ffff;
    }

    .table thead {
        height: 50px !important;
    }

    #tbl_Item th {
        font-size: 12px;
        text-align: left;
        vertical-align: top;
    }

    #tbl_Item thead {
        background-color: #c3c3c3;
    }

        #tbl_Item thead span {
            color: #e45050;
            font-size: 11px;
        }

    .content_table {
        padding-bottom: 72px;
    }

    #tbl_Item_length {
        position: absolute;
        bottom: 0px;
        left: 182px;
    }

    table.dataTable thead th, table.dataTable thead td {
        padding: 1px 5px !important;
        border-bottom: 1px solid #f1f1f1 !important;
        font-size: 11px !important;
    }

    .table > tr > td {
        padding: 1px 5px !important;
        border-bottom: 1px solid #f1f1f1 !important;
        font-size: 11px !important;
    }

    .container_1 {
        width: 100% !important;
        margin: 0 auto !important;
    }

    .rank2 {
        padding-bottom: 5px;
        width: 173px;
        padding-left: 14px;
        padding-right: 6px;
    }

    .container1 {
        width: 1300px;
        margin: auto;
    }

    table {
        width: 100%;
    }

    td {
        border: 1px solid black;
        width: 200px;
    }

    .hack1 {
        display: table;
        table-layout: fixed;
        width: 100%;
    }

    .hack2 {
        display: table-cell;
        overflow-x: auto;
        width: 100%;
    }

    .col {
        width: 10%
    }
</style>

@Html.Partial("~/Views/Shared/_sidebar_3.cshtml")

<div id="wp_order">
    <div class="header_vender_1">
        @Html.Partial("~/Views/Shared/_header_home.cshtml")
    </div>
    <div class="content_order">
        @Html.Partial("~/Views/PushSale/Partial/Header.cshtml")
        <div id="wp_order" style="padding-top: 165px; ">
            <div class="content_order">
                <div class="container_1  searchfroms">
                    <div class="content_search">
                        <div class="row">
                            <div class="col-md-5">
                                <div class="box_with">
                                    <div class="form-group row">
                                        <label for="MaHang" class="col-sm-4 col-form-label">Loại CTKM </label>
                                        <div class="col-sm-8">
                                            <select class="form-control" id="LoaiCTKM" onclick="js_searchbox_CTKM();">
                                                <option value="">-- Chọn CTKM --</option>
                                                <option value="Discount_Offer">Discount Offer</option>
                                                <option value="Mix_Match">Mix Match</option>
                                                <option value="Total_Discount">Total Discount</option>
                                            </select>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            <div class="col-md-5">
                                <div class="box_with">
                                    <div class="form-group row">
                                        <label for="textStatus" class="col-sm-4 col-form-label">Trạng thái</label>
                                        <div class="col-sm-8">
                                            <select class="form-control" id="textStatus" onclick="js_searchbox();">
                                                <option value="">-- Chọn trạng thái --</option>
                                                <option value="0">Mới tạo</option>
                                                <option value="2">Gửi duyệt</option>
                                                <option value="1">Đã duyệt</option>
                                                <option value="3">Từ chối</option>
                                            </select>
                                        </div>
                                    </div>
                                </div>
                            </div>

                            <div class="col-md-2" style="text-align: right;">
                                <select class="form-control " id="HanhDong" style=" margin-bottom: 3px !important; float: left; text-align: left; max-width: 150px; ">
                                    <option value="">-- Chọn hành động --</option>
                                    <option value="2">Gửi duyệt</option>
                                    <option value="4">Hủy bỏ</option>
                                </select>
                                <a onclick="HanhDongsave()" style="text-align: left; max-width: 150px;float:left;" class="btn btn-secondary btn_search"><i class="fa fa-forward" aria-hidden="true" style="margin-top: 3px; margin-right: 3px;"></i> Tiếp </a>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="container">
                    <div class="content_table">
                        <div class="row_2" style=" padding-top: 60px; ">
                            <div class="card-body" style="width:98%">
                                <div class="table-responsive_2" id="div-content">
                                    @Html.Partial("~/Views/PushSale/Partial/__ChuongTrinhKhuyenMai.cshtml")
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

    </div>
</div>

<script type="text/javascript">
    var listItems = @Html.Raw(jsonItems);
    var CTKM = 0;
    var row_LineGroup = 0;
    var MMLine = 0;
    SourceMixMaxLineGroup = [];
    var TTDL = 0;
    var TTD_BL = 0;

    $(function () {
        $('#txtHead').html("Quản lý chương trình Push Sale NCC");
        $('#f_dev').html("");
        $('#f_header').html("");
        $('#v_review').hide();
        $('#v_view').hide();
        $('#v_approve').hide();
        $("#ChuongTrinhKhuyenMai").prop("checked", true);
        Get_GAP_Case('');
        js_GetList();

    });

    function js_searchbox_NCC() {
        js_GetList();
    }
    function js_searchbox() {
        js_GetList();
    }

    function js_searchbox_CTKM() {
        var LoaiCTKM = $("#LoaiCTKM").val();
        switch (LoaiCTKM) {
            case "Discount_Offer":
                Get_GAP_Case('Discount_Offer');
                break;
            case "Mix_Match":
                Get_GAP_Case('Mix_Match');
                break;
            case "Total_Discount":
                Get_GAP_Case('Total_Discount');
                break;
            default:
                Get_GAP_Case('');
                break;
        }
        js_GetList();
    }

    function js_ReloadTable() {
        $('#tbl_Item').DataTable({
            lengthMenu: [[50, 70, 100, -1], [50, 70, 100]],
            //columnDefs: [
            //    //{ 'targets': 0, 'searchable': false, 'orderable': false },
            //    //{ 'targets': 2, 'searchable': false, 'orderable': false },
            //    //{ 'targets': 3, 'searchable': false, 'orderable': false },
            //    //{ 'targets': 4, 'searchable': false, 'orderable': false },
            //    { 'targets': 5, 'searchable': false, 'orderable': false },
            //    { 'targets': 6, 'searchable': false, 'orderable': false },
            //    { 'targets': 7, 'searchable': false, 'orderable': false }
            //],
            "searching": false,
            autoWidth: false,
            // pageLength: -1,
            "language": {
                "emptyTable": "Không có dữ liệu !"
            },
            fixedHeader: {
                headerOffset: 244
            }
        });
    }

    function js_GetList() {
        var VendorNo = fomart_split($("#VendorNo").val(), 0);
        var GAP = fomart_split($("#GAP").val(), 0);
        var LoaiCTKM = $("#LoaiCTKM").val();
        var Status = $("#textStatus option:selected").val();
        $.ajax({
            url: '/PushSale/Get_List_ChuongTrinhKhuyenMai',
            type: 'POST',
            data: JSON.stringify({ VendorNo:VendorNo,LoaiCTKM: LoaiCTKM, Status: Status, GAP: GAP }),
            contentType: 'application/json, charset=utf-8',
            beforeSend: function () {
                //js_Loading(true, 1);
                //console.log('gfdfgdf');
            },
            success: function (data) {
                $("#div-content").find('tbody').empty();
                $('#div-content').html(data);
                js_ReloadTable();
                //js_Loading(false, 1);
            },
            error: function () {
                //js_Loading(false, 1);
            }
        });
    }

    function HanhDongsave() {

        var IDPusSale = [];
        var HanhDong = $("#HanhDong").val();
        $("#CheckID input:checked").each(function (index, value) {
            IDPusSale.push($(value).val());
        });
        if (IDPusSale == "") {
            alert("Bạn chưa chọn hành động");
            return;
        }
        if (HanhDong == "") {
            alert("Bạn chưa chọn trạng thái");
            return;
        }
        if (HanhDong == "4") {
            console.log(JSON.stringify({ IDPusSale }));
            jConfirm('Bạn chắc chắn muốn xóa ?', '', function (r) {
                //ChuongTrinhKhuyenMai
                if (r) {
                    $.ajax({
                        type: "POST",
                        url: '/PushSale/Delete_ChuongTrinhKhuyenMai',
                        data: JSON.stringify({ IDPusSale: IDPusSale }),
                        contentType: "application/json; charset=utf-8",
                        dataType: "json",
                        success: function (rt) {
                            if (rt.code == 0) {
                                js_GetList();
                            }
                        }
                    });
                }
            });
        }
        else if (HanhDong == "2") {
            $.ajax({
                type: "POST",
                url: '/PushSale/Update_Status_ChuongTrinhKhuyenMai',
                data: JSON.stringify({ IDPusSale: IDPusSale, HanhDong: HanhDong }),
                contentType: "application/json; charset=utf-8",
                dataType: "json",
                success: function (rt) {
                    if (rt.code == 0) {
                        js_GetList();
                    }
                }
            });
        }
    }

    function ShowPopUp(value) {
        var values = value.trim();
        var Arrvalue = values.split('-');
        // Gán ID vào hidden để cập nhật
        $("#ID").val(Arrvalue[2]);

        if (Arrvalue[0] == "Discount_Offer") {

            // Call Line
            $.ajax({
                url: '/PushSale/Discount_Offer_Line_View',
                type: 'POST',
                data: JSON.stringify({ MaCTKM: Arrvalue[1] }),
                contentType: 'application/json, charset=utf-8',
                beforeSend: function () {
                },
                success: function (data) {
                    js_Fill_Discount_Offer(data);
                },
                error: function () {
                }
            });

            // Call Header
            $.ajax({
                url: '/PushSale/Discount_Offer_View',
                type: 'POST',
                data: JSON.stringify({ MaCTKM: Arrvalue[1] }),
                contentType: 'application/json, charset=utf-8',
                beforeSend: function () {
                },
                success: function (data) {
                    $("#MaCTKMDiscountOffer").val(data[0].MaCTKM);
                    $("#TuNgay_CTKM").val(data[0].FromDay);
                    $("#DenNgay_CTKM").val(data[0].ToDay);
                    // Popup
                    $("#CouponCode").val(data[0].CouponCode + ' - ' + data[0].CouponName);
                    $("#PhamVi_CTKM").val(data[0].PriceGroupCode + ' - ' + data[0].PriceGroupName);

                    // Kiểm tra nếu đã duyệt thì ko cho sửa disabled
                    if (data[0].Status == "1" || data[0].Status == "2" || data[0].Status == "3") {
                        // $("#GiaTruocThayDoi").prop("disabled", true);
                        //$("#TuNgay_CTKM").prop("disabled", true);
                        //$("#DenNgay_CTKM").prop("disabled", true);
                        //$("#CouponCode").prop("disabled", true);
                        //$("#PhamVi_CTKM").prop("disabled", true);

                        //// Line
                        //$("#Discount_Offer_line select[name='Type']").prop("disabled", true);
                        //$("#Discount_Offer_line select[name='NameProducts']").prop("disabled", true);
                        //$("#Discount_Offer_line input[name='DiscStdPrice']").prop("disabled", true);
                        //$("#Discount_Offer_line input[name='DiscAmountStdPrice']").prop("disabled", true);
                        $(".AnHien").css("pointer-events", "none");
                        $(".AnHien").css("opacity", "0.9");

                        $(".Luulai").hide();

                    } else {
                        //$("#TuNgay_CTKM").prop("disabled", false);
                        //$("#DenNgay_CTKM").prop("disabled", false);
                        //$("#CouponCode").prop("disabled", false);
                        //$("#PhamVi_CTKM").prop("disabled", false);
                        //// Line
                        //$("#Discount_Offer_line select[name='Type']").prop("disabled", false);
                        //$("#Discount_Offer_line select[name='NameProducts']").prop("disabled", false);
                        //$("#Discount_Offer_line input[name='DiscStdPrice']").prop("disabled", false);
                        //$("#Discount_Offer_line input[name='DiscAmountStdPrice']").prop("disabled", false);
                        $(".AnHien").css("pointer-events", "initial");
                        $(".AnHien").css("opacity", "1");

                        $(".Luulai").show();
                    }
                    $("select[name='NameProducts']").selectpicker('refresh');
                    $('#CouponCode').selectpicker('refresh');
                    $('#PhamVi_CTKM').selectpicker('refresh');
                },
                error: function () {
                }
            });
            document.getElementById("ShowDiscountOffer").click();
        }
        if (Arrvalue[0] == "Mix_Match") {
            $('#tbl_MixMatch tbody').empty();
            $('#tbl_MixMaxLine tbody').empty();
            // Call Header
            $.ajax({
                url: '/PushSale/Mix_Match_View',
                type: 'POST',
                data: JSON.stringify({ MaCTKM: Arrvalue[1] }),
                contentType: 'application/json, charset=utf-8',
                beforeSend: function () {
                },
                success: function (data) {

                    $('#MaCTKM_MixMatch').val(data[0].MaCTKM);
                    $('#CouponCode_MixMatch').val(data[0].CouponCode + ' - ' + data[0].CouponName);
                    $('#TuNgay_MixMatch').val(data[0].FromDay);
                    $('#DenNgay_MixMatch').val(data[0].ToDay);
                    $('#PhamVi_MixMatch').val(data[0].PriceGroupCode + ' - ' + data[0].PriceGroupName);

                    $('#NoOfLeastItem').val(data[0].NoOfLeastItem);
                    $('#Leastexp').val(data[0].Leastexp);
                    $('#Same_DifLine').val(data[0].Same_DifLine);
                    $('#Mix_DiscountType').val(data[0].Mix_DiscountType);
                    $('#DealPriceValue').val(data[0].DealPriceValue);
                    $('#DiscValue').val(data[0].DiscValue);
                    $('#DiscountAmoutValue').val(data[0].DiscountAmoutValue);
                    $('#NoTimeApp').val(data[0].NoTimeApp);

                    $('#PhamVi_MixMatch').selectpicker('refresh');
                    $('#CouponCode_MixMatch').selectpicker('refresh');

                    // Kiểm tra nếu đã duyệt thì ko cho sửa disabled
                    if (data[0].Status == "1" || data[0].Status == "2" || data[0].Status == "3") {
                        $(".AnHienMiMX").css("pointer-events", "none");
                        $(".AnHienMiMX").css("opacity", "0.9");
                        $(".Luulai").hide();

                    } else {
                        $(".AnHienMiMX").css("pointer-events", "initial");
                        $(".AnHienMiMX").css("opacity", "1");
                        $(".Luulai").show();
                    }
                },
                error: function () {
                }
            });

            // Call Line Groups
            $.ajax({
                url: '/PushSale/MixMatch_Line_View',
                type: 'POST',
                data: JSON.stringify({ MaCTKM: Arrvalue[1] }),
                contentType: 'application/json, charset=utf-8',
                beforeSend: function () {
                },
                success: function (data) {
                    $('#tbl_MixMatch tbody').empty();
                    js_Fill_MixMatch_Groups(data);

                },
                error: function () {

                }
            });

            // Call Line
            $.ajax({
                url: '/PushSale/MixMatch_Line_Groups_View',
                type: 'POST',
                data: JSON.stringify({ MaCTKM: Arrvalue[1] }),
                contentType: 'application/json, charset=utf-8',
                beforeSend: function () {
                },
                success: function (data) {
                    $('#tbl_MixMaxLine tbody').empty();
                    setTimeout(function () {
                        js_Fill_MixMatch_Line(data);
                    }, 1000);
                },
                error: function () {

                }
            });

            document.getElementById("ShowMixMatch").click();
        }
        if (Arrvalue[0] == "Total_Discount") {

            // Call Header
            $.ajax({
                url: '/PushSale/Total_Discount_View',
                type: 'POST',
                data: JSON.stringify({ MaCTKM: Arrvalue[1] }),
                contentType: 'application/json, charset=utf-8',
                beforeSend: function () {
                },
                success: function (data) {
                    $('#MaCTKM_TotalDiscount').val(data[0].MaCTKM);
                    $('#CouponCode_TotalDiscount').val(data[0].CouponCode + ' - ' + data[0].CouponName);
                    $('#TuNgay_TotalDiscount').val(data[0].FromDay);
                    $('#DenNgay_TotalDiscount').val(data[0].ToDay);
                    $('#PhamVi_TotalDiscount').val(data[0].PriceGroupCode + ' - ' + data[0].PriceGroupName);

                    $('#PhamVi_TotalDiscount').selectpicker('refresh');
                    $('#CouponCode_TotalDiscount').selectpicker('refresh');

                    // Kiểm tra nếu đã duyệt thì ko cho sửa disabled
                    if (data[0].Status == "1" || data[0].Status == "2" || data[0].Status == "3") {
                        $(".AnHienTotalDiscount").css("pointer-events", "none");
                        $(".AnHienTotalDiscount").css("opacity", "0.9");
                        $(".Luulai").hide();

                    } else {
                        $(".AnHienTotalDiscount").css("pointer-events", "initial");
                        $(".AnHienTotalDiscount").css("opacity", "1");
                        $(".Luulai").show();
                    }

                },
                error: function () {
                }
            });

            // Call Line
            $.ajax({
                url: '/PushSale/Total_Discount_Line_View',
                type: 'POST',
                data: JSON.stringify({ MaCTKM: Arrvalue[1] }),
                contentType: 'application/json, charset=utf-8',
                beforeSend: function () {
                },
                success: function (data) {
                    js_Fill_Total_Discount_Line(data);
                },
                error: function () {
                }
            });

            //Call Benefits
            $.ajax({
                url: '/PushSale/Total_Discount_Line_Benefits_View',
                type: 'POST',
                data: JSON.stringify({ MaCTKM: Arrvalue[1] }),
                contentType: 'application/json, charset=utf-8',
                beforeSend: function () {
                },
                success: function (data) {
                    js_Fill_Total_Discount_Line_Benefits(data);
                },
                error: function () {
                }
            });

            document.getElementById("ShowTotalDiscount").click();
        }
    };

    function js_Fill_Discount_Offer(data) {
        if (data instanceof Object && data !== null && data.length) {
            let i = 0;
            $('#Discount_Offer_line tbody').empty();
            $.each(data, (index, values) => {
                i++;
                //let tr = '';
                //tr += '<tr>';
                //tr += '<td class="text-center">' + values.Type + '</td>';
                //tr += '<td class="text-left">' + values.ProductCode + ' - ' + values.ProductName + '</td>';
                //tr += '<td class="text-right">' + values.DiscStdPrice + '</td>';
                //tr += '<td class="text-right">' + values.DiscAmountStdPrice + '</td>';
                //tr += '</tr>';
                //$('#Discount_Offer_line tbody').append(tr);

                CTKM++;
                var chuoi = "";
                var TTC = CTKM - 1;
                $("#row_" + TTC + " .btn_add ").empty();
                $("#row_" + TTC + " .btn_add ").html('<a class="AnHien"  href="javascript:void(0);" onclick="deleteRow(this);" class="btn_add"><i class="fa fa-trash" aria-hidden="true"></i></a>');
                chuoi += '<tr id="row_' + CTKM + '">';
                chuoi += '<td style=" width: 8%;"><select style="width:100% !important"  class="form-control" name="Type"><option value="Item">Item</option></select></td>';
                chuoi += '<td style=" width: 25%;max-width: 25%;" class="spname"><select style="width: 25% !important;max-width: 25% !important;float: left;left: 0px;" id="NameProducts_' + CTKM + '" onchange="js_changeInfoDisOffer(' + CTKM + ')" class="form-control selectpicker" name="NameProducts" data-live-search="true">';
                chuoi += '<option value="">--Chọn--</option>';
                $.each(listItems, (index, item) => {
                    if (item.Code == values.ProductCode) {
                        chuoi += '<option selected value="' + item.Code + ' - ' + item.Name + '">' + item.Code + ' - ' + item.Name + '</option>';
                    } else {
                        chuoi += '<option value="' + item.Code + ' - ' + item.Name + '">' + item.Code + ' - ' + item.Name + '</option>';
                    }
                });
                chuoi += '</select></td>';
                chuoi += '<td style=" width: 14%; "><input style="width:100% !important" value="' + values.DiscStdPrice + '" type="text" name="DiscStdPrice" class="form-control OrderValue" /></td>';
                chuoi += '<td style=" width: 14%; "><input style="width:100% !important" value="' + values.DiscAmountStdPrice + '"  type="text" name="DiscAmountStdPrice" class="form-control OrderValue" /></td>';
                chuoi += '<td style="text-align:center;width:3%; " class="btn_add"><a  class="AnHien" href="javascript:void(0)" onclick="js_add_Discount_Offer(' + CTKM + ');"><i class="fa fa-plus" aria-hidden="true"></i></a></td></tr > ';
                $("#Discount_Offer_line tbody").append(chuoi);
                $('.selectpicker').selectpicker();
            });
        } else {
            $('#Discount_Offer_line tbody').empty();
            js_add_Discount_Offer();
           // $('#Discount_Offer_line tbody').empty().html('<tr><td colspan="5"><p style="text-align: center;font-weight: bold;">Không có dữ liệu</p></td></tr>');
        }
    }

    function js_Fill_MixMatch_Groups(data) {
        if (data instanceof Object && data !== null && data.length) {
            let i = 0;
            $('#tbl_MixMatch tbody').empty();
            $.each(data, (index, value) => {
                i++;
                row_LineGroup++;
                var lg = row_LineGroup - 1;
                $("#rowLineGroup_" + lg + " .btn_add").empty();
                $("#rowLineGroup_" + lg + " .btn_add").html('<a href="javascript:void(0);" onclick="deleteRowMixMaxLineGroup(this);" class="btn_add"><i class="fa fa-trash" aria-hidden="true"></i></a>');
                let tr = '';
                tr += '<tr id="rowLineGroup_' + row_LineGroup + '" onchange="getTablePopupMixMatch()">';
                tr += '    <td>';
                tr += '        <input value="' + value.LineGroupCode +'" style="width:100% !important" type="text" name="LineGroupCode" class="form-control" />';
                tr += '    </td>';
                tr += '    <td>';
                tr += '        <select style="width:100% !important" class="form-control" name="LineGroupType" id="LineGroupType_' + row_LineGroup + '">';
                tr += '            <option value="No_of_Lines">No. of Lines</option>';
                tr += '            <option value="Range">Range</option>';
                tr += '        </select>';
                tr += '    </td>';
                tr += '    <td>';
                tr += '        <input value="' + value.value1 +'" style="width:100% !important" type="text" name="value1" id="value1_' + row_LineGroup + '" class="form-control OrderValue" />';
                tr += '    </td>';
                tr += '    <td>';
                tr += '        <input value="' + value.value2 +'" style="width:100% !important" type="text" name="value2" id="value2_' + row_LineGroup + '" class="form-control OrderValue" />';
                tr += '    </td>';
                tr += '    <td style="text-align:center;width: 115px;" class="btn_add"><a href="javascript:void(0);" onclick="js_addRowMixMaxLineGroup(' + row_LineGroup + ');"><i class="fa fa-plus" aria-hidden="true"></i></a></td>';
                tr += '</tr>';
                $('#tbl_MixMatch tbody').append(tr);

                // selected
                $("#LineGroupType_" + row_LineGroup + "").val(value.lineGroupType1);
            });
        } else {
            $('#tbl_MixMatch tbody').empty()
            js_addRowMixMaxLineGroup();
            // $('#tbl_MixMatch tbody').empty().html('<tr><td colspan="4"><p style="text-align: center;font-weight: bold;">Không có dữ liệu</p></td></tr>');
        }
         getTablePopupMixMatch();
    }

    function js_Fill_MixMatch_Line(data) {
        if (data instanceof Object && data !== null && data.length) {
            let i = 0;
            $('#tbl_MixMaxLine tbody').empty();
            $.each(data, (index, value) => {
                MMLine++;
                var lg = MMLine - 1;
                $("#row_" + lg + " .btn_add").empty();
                $("#row_" + lg + " .btn_add").html('<a href="javascript:void(0);" onclick="js_deleteRowMixMaxLine(this);" class="btn_add"><i class="fa fa-trash" aria-hidden="true"></i></a>');
                let html = '';
                html += '<tr id="row_' + MMLine + '">';
                html += '<td style="width: 80px; max-width: 80px " ><select style="width:100% !important"  class="form-control" name="type"><option value="Item">Item</option></select></td>';

                html += '<td style="width: 290px; max-width: 290px" class="spname"><select style="width:100% !important;float: left;left: 0px;" name="NoMixMatch"  id="NoMixMatch_' + MMLine + '" onchange="js_MixMatchNo(' + MMLine + ')" class="form-control selectpicker" name="No" data-live-search="true">';
                html += '<option value="">--Chọn--</option>';
                $.each(listItems, (index, item) => {
                    if (item.Code == value.ProductCode) {
                        html += '<option selected value="' + item.Code + ' - ' + item.Name + '">' + item.Code + ' - ' + item.Name + '</option>';
                    } else {
                        html += '<option value="' + item.Code + ' - ' + item.Name + '">' + item.Code + ' - ' + item.Name + '</option>';
                    }
                });
                html += '</select></td>';

                html += '<td style="width: 140px; max-width: 140px " ><input value="' + value.NoItemNeeded + '" style="width:100% !important"  type="text" name="NoItemNeeded" id="NoItemNeeded_' + MMLine + '" class="form-control OrderValue"/></td>';
                html += '<td style="width: 140px; max-width: 140px " ><input value="' + value.DealPriceDiscPercent + '"  style="width:100% !important"  type="text" name="Deal_Price_Disc_Percent" id="Deal_Price_Disc_Percent_' + MMLine + '" class="form-control OrderValue"/></td>';
                html += '<td style="width: 110px; max-width: 110px " ><select style="width:100% !important"  class="form-control" name="DiscTypeMix" id="DiscTypeMix_' + MMLine + '"><option value="Deal_Price">Deal Price</option><option value="Disc_Precent">Disc. %</option></select></td>';
                html += '<td style="width: 150px; max-width: 150px " ><select style="width:100% !important"  class="form-control lineGroup_datalist" name="LineGroup id="LineGroup_' + MMLine + '">';
                for (let i = 0; i < SourceMixMaxLineGroup.length; ++i) {
                    if (SourceMixMaxLineGroup[i]["LineGroupCode"] == value.LineGroup) {
                        html += ' <option selected value = ' + SourceMixMaxLineGroup[i]["LineGroupCode"] + ' > ' + SourceMixMaxLineGroup[i]["LineGroupCode"] + '</option>';
                    } else {
                        html += '<option value=' + SourceMixMaxLineGroup[i]["LineGroupCode"] + '>' + SourceMixMaxLineGroup[i]["LineGroupCode"] + '</option>';
                    }
                }
                html += '</select></td>';
                html += '<td style="width: 80px; max-width: 80px ;text-align:center" class="btn_add"><a href="javascript:void(0)" onclick="js_addRowMixLine(' + MMLine + ');"><i class="fa fa-plus" aria-hidden="true"></i></a></td>';
                html += '</tr>';
                $("#tbl_MixMaxLine tbody").append(html);
                $('.selectpicker').selectpicker();
                // selected
                $("#DiscTypeMix_" + MMLine + "").val(value.DiscType1);
               // console.log(value.DiscType1);
            });
        } else {
            $('#tbl_MixMaxLine tbody').empty();
            js_addRowMixLine();
           // $('#tbl_MixMaxLine tbody').empty().html('<tr><td colspan="6"><p style="text-align: center;font-weight: bold;">Không có dữ liệu</p></td></tr>');
        }
    }

    function js_Fill_Total_Discount_Line(data) {
        debugger;
        if (data instanceof Object && data !== null && data.length) {
            $('#tbl_TotalTotalDiscountLine tbody').empty();
            $.each(data, (index, value) => {
                TTDL++;
                let html = '';
                var TTC = TTDL - 1;
                $("#rowTTDL_" + TTC + " .btn_add").empty();
                $("#rowTTDL_" + TTC + " .btn_add").html('<a href="javascript:void(0);" onclick="js_deleteRowTDOLine(this);" class="btn_add"><i class="fa fa-trash" aria-hidden="true"></i></a>');

                html += '<tr id="rowTTDL_' + TTDL + '">';
                html += '<td  style="width:15%;"><select style="width:100% !important"  class="form-control" name="typeLine"><option value="Item">Item</option></select></td>';
                html += '<td style="width:75%;"><select style="width:100% !important"  id="NoTotalDsNoLine_' + TTDL + '" onchange="js_TotalDsNo_TT_DC(' + TTDL + ')" class="form-control selectpicker" name="NoTotalDsNoLine" data-live-search="true">';
                html += '<option value="">--Chọn--</option>';
                $.each(listItems, (index, item) => {
                    if (item.Code == value.ProductCode)
                    {
                        html += '<option selected value=\"' + item.Code + ' - ' + item.Name + '\">' + item.Code + ' - ' + item.Name + '</option>';
                    } else {
                        html += '<option value=\"' + item.Code + ' - ' + item.Name + '\">' + item.Code + ' - ' + item.Name + '</option>';
                    }
                });
                html += '</select></td>';
                html += '<td style="text-align:center;width:9%;" class="btn_add"><a href="javascript:void(0)" onclick="js_addRowTDOLine(' + TTDL + ');"><i class="fa fa-plus" aria-hidden="true"></i></a></td>';
                html += '</tr>';
                $('#tbl_TotalTotalDiscountLine tbody').append(html);
                $('#NoTotalDsNoLine_' + TTDL + '').selectpicker('refresh');
            });
        } else {
            $('#tbl_TotalTotalDiscountLine tbody').empty();
            js_addRowTDOLine();
           // $('#tbl_TotalTotalDiscountLine tbody').empty().html('<tr><td colspan="2"><p style="text-align: center;font-weight: bold;">Không có dữ liệu</p></td></tr>');
        }
    }

    function js_Fill_Total_Discount_Line_Benefits(data) {
        debugger;
        if (data instanceof Object && data !== null && data.length) {
           // let j = 0;
            $('#tbl_TotalTotalDiscount tbody').empty();
            $.each(data, (index, value) => {
                TTD_BL++;
                let html = '';

                //tr += '<tr>';
                //tr += '<td class="text-right"></td>';
                //tr += '<td class="text-left">' + value.Type + '</td>';
                //tr += '<td class="text-left">' + value.ProductCode + ' - ' + value.ProductName + '</td>';
                //tr += '<td class="text-center">' + value.ValueType + '</td>';
                //tr += '<td class="text-right">' + value.Value + '</td>';
                //tr += '</tr>';

                var dt = TTD_BL - 1;
                $("#rowBL_" + dt + " .btn_add").empty();
                $("#rowBL_" + dt + " .btn_add").html('<a href="javascript:void(0);" onclick="js_deleteRowTotalTotalDiscount(this);" class="btn_add"><i class="fa fa-trash" aria-hidden="true"></i></a>');

                html += '<tr id="rowBL_' + TTD_BL + '">';
                html += '<td> <input value=' + value.StepAmount + ' style="width:100% !important" type="number" name="StepAmount" id="StepAmount_' + TTD_BL + '" class="form-control" /></td > ';
                html += '<td><select style="width:100% !important" onchange="js_changeTypeBeBe(' + TTD_BL + ')" id="TypeTD_' + TTD_BL+ '" name="TypeTD" class="form-control"><option value="Item">Item</option><option value="Coupon">Coupon</option></select></td>';
                html += '<td><select onchange="js_ChangeTotalDsOffer(' + TTD_BL + ')" id="NoBeBeTotal_' + TTD_BL + '" name="NoBeBeTotal" class="form-control selectpicker" data-live-search="true"></select ></td >';
                html += '<td><select style="width:100% !important" id="ValueType_' + TTD_BL + '" name="ValueType" class="form-control" id="ValueType_' + TTD_BL + '"></select></td>';
                html += '<td><input value=' + value.Value + ' style="width:100% !important" type="number" id="valueTD_' + TTD_BL + '" name="valueTD" class="form-control text-right" /></td>';
                html += '<td style="text-align:center;width:100px; " class="btn_add"><a href="javascript:void(0)" onclick="js_addRowTotalTotalDiscount(' + TTD_BL+ ');"><i class="fa fa-plus" aria-hidden="true"></i></a></td>';
                html += '</tr>';

                $('#tbl_TotalTotalDiscount tbody').append(html);

                $("#TypeTD_" + TTD_BL + "").val(value.Type);
                js_changeTypeBeBe_PopUp(TTD_BL, value.ProductCode + ' - ' + value.ProductName);
                //$('#NoBeBeTotal_' + j + '').selectpicker('refresh');

                $("#NoBeBeTotal_" + TTD_BL + "").val(value.ProductCode + ' - ' + value.ProductName);
                $("#ValueType_" + TTD_BL + "").val(value.ValueType1);
            });
        } else {
            $('#tbl_TotalTotalDiscount tbody').empty();
            js_addRowTotalTotalDiscount();

          //  $('#tbl_TotalTotalDiscount tbody').empty().html('<tr><td colspan="5"><p style="text-align: center;font-weight: bold;">Không có dữ liệu</p></td></tr>');
        }
    }

    function js_changeTypeBeBe_PopUp(r, Code) {

        var type = $('#TypeTD_' + r).val();
        if (type == 'Item') {
            $.ajax({
                url: '/PushSale/GetListNoTotalDisOffer_TotalDiscount',
                type: 'POST',
                data: JSON.stringify({ type: type }),
                contentType: 'application/json, charset=utf-8',
                success: function (data) {
                    $("#NoBeBeTotal_" + r).empty();
                    if (data.length > 0) {
                        $("#NoBeBeTotal_" + r).append('<option value="">--Chọn--</option>');
                        $.each(data, (index, value) => {
                            if (Code == value.Code + ' - ' + value.Name) {
                                $("#NoBeBeTotal_" + r).append('<option selected value=\"' + value.Code + ' - ' + value.Name + '\">' + value.Code + ' - ' + value.Name + '</option>');
                            } else {
                                $("#NoBeBeTotal_" + r).append('<option value=\"' + value.Code + ' - ' + value.Name + '\">' + value.Code + ' - ' + value.Name + '</option>');
                            }
                        });
                        $("#NoBeBeTotal_" + r).selectpicker('refresh');
                    }
                }
            });

            $('#ValueType_' + r).empty();
            //$('#No_' + r).prop('disabled', false);
            $('#ValueType_' + r).prop('disabled', false);
            $('#valueTD_' + r).prop('disabled', false);
            $('#ValueType_' + r).append('<option value="Amount">Amount</option>');

        }
        //if (type == 'Discount') {
        //    $('#ValueType_' + r).empty();
        //    //$('#No_' + r).prop('disabled', true);
        //    $('#ValueType_' + r).prop('disabled', false);
        //    $('#valueTD_' + r).prop('disabled', false);
        //    $('#ValueType_' + r).append('<option value="Amount">Amount</option><option value="Percent">%</option>');
        //}
        if (type == 'Coupon') {
            $.ajax({
                url: '/PushSale/GetListNoTotalDisOffer_TotalDiscount',
                type: 'POST',
                data: JSON.stringify({ type: type }),
                contentType: 'application/json, charset=utf-8',
                success: function (data) {
                    $("#NoBeBeTotal_" + r).empty();
                    if (data.length > 0) {
                        $("#NoBeBeTotal_" + r).append('<option value="">--Chọn Coupon--</option>');
                        $.each(data, (index, value) => {
                            if (Code == value.Code + ' - ' + value.Name) {
                                $("#NoBeBeTotal_" + r).append('<option selected value=\"' + value.Code + ' - ' + value.Name + '\">' + value.Code + ' - ' + value.Name + '</option>');
                            } else {
                                $("#NoBeBeTotal_" + r).append('<option value=\"' + value.Code + ' - ' + value.Name + '\">' + value.Code + ' - ' + value.Name + '</option>');
                            }
                        });
                        $("#NoBeBeTotal_" + r).selectpicker('refresh');
                    }
                }
            });
            $('#ValueType_' + r).empty();
            //$('#No_' + r).prop('disabled', false);
            $('#ValueType_' + r).prop('disabled', true);
            $('#valueTD_' + r).prop('disabled', true);
        }
    }

    function Get_GAP_Case(type) {
        $("#GAP").val('');
        $('#GAP').selectpicker().empty();
        option = document.createElement('option');
        option.text = '-- Chọn mã GAP --';
        option.value = '';
        $('#GAP').selectpicker().append(option);

        $.ajax({
            url: '/PushSale/Get_GAP_CTKM_Type',
            data: JSON.stringify({ MaCTKM: type }),
            type: 'POST',
            contentType: 'application/json, charset=utf-8',
            success: function (data) {
                $.each(data, (index, value) => {
                    option = document.createElement('option');
                    option.text = value.Code + ' - ' + value.Name;
                    option.value = value.Code + ' - ' + value.Name;
                    $('#GAP').selectpicker().append(option);
                });
                $('#GAP').selectpicker('refresh');
            }
        });
    }

</script>

<script>
    //Update PopUp Discount Offer
    function js_add_Discount_Offer(r) {
        CTKM++;
        var chuoi = "";
        var TTC = CTKM - 1;
        $("#row_" + TTC + " .btn_add ").empty();
        $("#row_" + TTC + " .btn_add ").html('<a class="AnHien"  href="javascript:void(0);" onclick="deleteRow(this);" class="btn_add"><i class="fa fa-trash" aria-hidden="true"></i></a>');
        chuoi += '<tr id="row_' + CTKM + '">';
        chuoi += '<td style=" width: 8%;"><select style="width:100% !important"   class="form-control" name="Type"><option value="Item">Item</option></select></td>';
        chuoi += '<td style=" width: 20%;max-width: 20%;" class="spname"><select style="width: 20% !important;max-width: 20% !important;float: left;left: 0px;" id="NameProducts_' + CTKM + '" onchange="js_changeInfoDisOffer(' + CTKM + ')" class="form-control selectpicker" name="NameProducts" data-live-search="true">';
        chuoi += '<option value="">--Chọn--</option>';
        $.each(listItems, (index, value) => {
            chuoi += '<option value="' + value.Code + ' - ' + value.Name + '">' + value.Code + ' - ' + value.Name + '</option>';
        });
        chuoi += '</select></td>';
        chuoi += '<td style=" width: 14%; "><input style="width:100% !important" type="text" name="DiscStdPrice" class="form-control OrderValue" /></td>';
        chuoi += '<td style=" width: 14%; "><input style="width:100% !important" type="text" name="DiscAmountStdPrice" class="form-control OrderValue" /></td>';
        chuoi += '<td style="text-align:center;width:3%; " class="btn_add "><a class="AnHien" href="javascript:void(0)" onclick="js_add_Discount_Offer(' + CTKM + ');"><i class="fa fa-plus" aria-hidden="true"></i></a></td></tr > ';
        $("#Discount_Offer_line tbody").append(chuoi);
        $('.selectpicker').selectpicker();
    }

    function deleteRow(r) {
        var ri = r.parentNode.parentNode.rowIndex;
        document.getElementById("Discount_Offer_line").deleteRow(ri);
    }

    function js_changeInfoDisOffer(r) {
        var MaHang = $('#NameProducts_' + r).val();
        var arMaHang = MaHang.split(' - ');
        var str = 'row_' + r;
        let trs = $("#Discount_Offer_line tbody tr");
        if (trs.length) {
            trs.each((index, tr) => {
                if (str != tr.id) {
                    let MaHang_old = String($('#' + tr.id + ' select[name="NameProducts"]').val()).trim();
                    var arMaHang_old = MaHang_old.split(' - ');
                    if (arMaHang_old[0] == arMaHang[0]) {
                        var ri = confirm('Mã ' + arMaHang[0] + ' đã có. Bạn vui lòng chọn mã khác !');
                        if (ri) {
                            $("#NameProducts_" + r).val('');
                        }
                    }
                }
            });
        }
    }
</script>

<script>
    //Update PopUp MixMax
    function js_addRowMixMaxLineGroup() {
        row_LineGroup++;
        var lg = row_LineGroup - 1;
        $("#rowLineGroup_" + lg + " .btn_add").empty();
        $("#rowLineGroup_" + lg + " .btn_add").html('<a href="javascript:void(0);" onclick="deleteRowMixMaxLineGroup(this);" class="btn_add"><i class="fa fa-trash" aria-hidden="true"></i></a>');
        $("#tbl_MixMatch tbody").append('<tr id="rowLineGroup_' + row_LineGroup + '"  onchange="getTablePopupMixMatch()"><td><input  style="width:100% !important"  type="text" name="LineGroupCode" class="form-control" /></td><td><select style="width:100% !important"  class="form-control" name="LineGroupType" id="LineGroupType_' + row_LineGroup + '"><option value="No_of_Lines">No. of Lines</option><option value="Range">Range</option></select></td><td><input style="width:100% !important"  type="text" name="value1" id="value1_' + row_LineGroup + '" class="form-control OrderValue" /></td><td><input style="width:100% !important"  type="text" name="value2" id="value2_' + row_LineGroup + '" class="form-control OrderValue" /></td><td style="text-align:center;width: 115px;" class="btn_add"><a href="javascript:void(0);" onclick="js_addRowMixMaxLineGroup(' + row_LineGroup + ');"><i class="fa fa-plus" aria-hidden="true"></i></a></td></tr>');
    }

    function js_addRowMixLine() {

        MMLine++;
        if (SourceMixMaxLineGroup.length > 0) {
            var html = '';
            var lg = MMLine - 1;
            $("#row_" + lg + " .btn_add").empty();
            $("#row_" + lg + " .btn_add").html('<a href="javascript:void(0);" onclick="js_deleteRowMixMaxLine(this);" class="btn_add"><i class="fa fa-trash" aria-hidden="true"></i></a>');

            html += '<tr id="row_' + MMLine + '">';
            html += '<td style="width: 80px; max-width: 80px " ><select style="width:100% !important"  class="form-control" name="type"><option value="Item">Item</option></select></td>';

            html += '<td style="width: 290px; max-width: 290px" class="spname"><select style="width:100% !important;float: left;left: 0px;" name="NoMixMatch"  id="NoMixMatch_' + MMLine + '" onchange="js_MixMatchNo(' + MMLine + ')" class="form-control selectpicker" name="No" data-live-search="true">';
            html += '<option value="">--Chọn--</option>';
            $.each(listItems, (index, value) => {
                html += '<option value="' + value.Code + ' - ' + value.Name + '">' + value.Code + ' - ' + value.Name + '</option>';
            });
            html += '</select></td>';

            html += '<td style="width: 140px; max-width: 140px " ><input style="width:100% !important"  type="text" name="NoItemNeeded" id="NoItemNeeded_' + MMLine + '" class="form-control OrderValue"/></td>';
            html += '<td style="width: 140px; max-width: 140px " ><input style="width:100% !important"  type="text" name="Deal_Price_Disc_Percent" id="Deal_Price_Disc_Percent_' + MMLine + '" class="form-control OrderValue"/></td>';
            html += '<td style="width: 110px; max-width: 110px " ><select style="width:100% !important"  class="form-control" name="DiscTypeMix" id="DiscTypeMix_' + MMLine + '"><option value="Deal_Price">Deal Price</option><option value="Disc_Precent">Disc. %</option></select></td>';
            html += '<td style="width: 150px; max-width: 150px " ><select style="width:100% !important"  class="form-control lineGroup_datalist" name="LineGroup">';
            for (let i = 0; i < SourceMixMaxLineGroup.length; ++i) {
                html += '<option value=' + SourceMixMaxLineGroup[i]["LineGroupCode"] + '>' + SourceMixMaxLineGroup[i]["LineGroupCode"] + '</option>';
            }
            html += '</select></td>';
            html += '<td style="width: 80px; max-width: 80px ;text-align:center" class="btn_add"><a href="javascript:void(0)" onclick="js_addRowMixLine(' + MMLine + ');"><i class="fa fa-plus" aria-hidden="true"></i></a></td>';
            html += '</tr>';
            $("#tbl_MixMaxLine tbody").append(html);
            $('.selectpicker').selectpicker();
        }
        else {
            var html = '';
            var lg = MMLine - 1;
            $("#row_" + lg + " .btn_add").empty();
            $("#row_" + lg + " .btn_add").html('<a href="javascript:void(0);" onclick="js_deleteRowMixMaxLine(this);" class="btn_add"><i class="fa fa-trash" aria-hidden="true"></i></a>');

            html += '<tr id="row_' + MMLine + '">';
            html += '<td style="width: 80px; max-width: 80px " ><select style="width:100% !important"  class="form-control" name="type"><option value="Item">Item</option></select></td>';

            html += '<td style="width: 290px; max-width: 290px" class="spname"><select style="width:100% !important;float: left;left: 0px;" name="NoMixMatch"  id="NoMixMatch_' + MMLine + '" onchange="js_MixMatchNo(' + MMLine + ')" class="form-control selectpicker" name="No" data-live-search="true">';
            html += '<option value="">--Chọn--</option>';
            $.each(listItems, (index, value) => {
                html += '<option value="' + value.Code + ' - ' + value.Name + '">' + value.Code + ' - ' + value.Name + '</option>';
            });
            html += '</select></td>';

            html += '<td style="width: 140px; max-width: 140px " ><input style="width:100% !important"  type="text" name="NoItemNeeded" id="NoItemNeeded_' + MMLine + '" class="form-control OrderValue"/></td>';
            html += '<td style="width: 140px; max-width: 140px " ><input style="width:100% !important"  type="text" name="Deal_Price_Disc_Percent" id="Deal_Price_Disc_Percent_' + MMLine + '" class="form-control OrderValue"/></td>';
            html += '<td style="width: 110px; max-width: 110px " ><select style="width:100% !important"  class="form-control" name="DiscTypeMix" id="DiscTypeMix_' + MMLine + '"><option value="Deal_Price">Deal Price</option><option value="Disc_Precent">Disc. %</option></select></td>';
            html += '<td style="width: 150px; max-width: 150px " ><select style="width:100% !important"  class="form-control lineGroup_datalist" name="LineGroup"></select></td>';
            html += '<td style="width: 80px; max-width: 80px ;text-align:center" class="btn_add"><a href="javascript:void(0)" onclick="js_addRowMixLine(' + MMLine + ');"><i class="fa fa-plus" aria-hidden="true"></i></a></td>';
            html += '</tr>';
            $("#tbl_MixMaxLine tbody").append(html);
            $('.selectpicker').selectpicker();
        }
    }

    function js_MixMatchNo(r) {

        var MaHang = $('#NoMixMatch_' + r).val();
        var arMaHang = MaHang.split(' - ');
        var str = 'row_' + r;
        let trs = $("#tbl_MixMaxLine tbody tr");
        if (trs.length) {
            trs.each((index, tr) => {
                if (str != tr.id) {
                    let MaHang_old = String($('#' + tr.id + ' select[name="NoMixMatch"]').val()).trim();
                    var arMaHang_old = MaHang_old.split(' - ');
                    if (arMaHang_old[0] == arMaHang[0]) {
                        var ri = confirm('Mã ' + arMaHang[0] + ' đã có. Bạn vui lòng chọn mã khác !');
                        if (ri) {
                            $("#NoMixMatch_" + r).val('');
                        }
                    }
                }
            });
        }
    }

    function deleteRowMixMaxLineGroup(r) {
        var ri = r.parentNode.parentNode.rowIndex;
        document.getElementById("tbl_MixMatch").deleteRow(ri);
        getTablePopupMixMatch();
    }

    function js_deleteRowMixMaxLine(r) {
        var ri = r.parentNode.parentNode.rowIndex;
        document.getElementById("tbl_MixMaxLine").deleteRow(ri);
    }

</script>

<input type="hidden" name="ID" id="ID" value="0" />
@Html.Partial("~/Views/PushSale/TabCTKKM/PopUp/DiscountOffer.cshtml")
@Html.Partial("~/Views/PushSale/TabCTKKM/PopUp/MixMatch.cshtml")
@Html.Partial("~/Views/PushSale/TabCTKKM/PopUp/TotalDiscount.cshtml")
