@using System.Data
<div class="table-responsive">
    <table id="tbl_Item" class="table table-striped table-bordered table-hover" cellspacing="0" width="100%">
        <thead>
            <tr>
                <th class="text-center">
                    Miền
                </th>
                <th class="text-center">
                    Tỉnh/Thành
                </th>
                <th class="text-center">
                    Kho nhận
                </th>
                <th class="text-center">
                    Mã đơn đặt hàng
                </th>
                <th class="text-center">
                    Ngày đặt hàng
                </th>
                <th class="text-center">
                     SL Đặt
                </th>
                <th class="text-center">
                     SL XN giao
                </th>
                <th class="text-center">
                    SL đã giao
                </th>
                <th class="text-center">
                    SL chênh lệch
                </th>
                <th class="text-center">
                    Tổng tiền <br />(-VAT)
                </th>
                <th class="text-center">
                     M3
                </th>
                <th class="text-center">
                    Chi tiết
                </th>
                <th class="text-center">
                    Trạng thái
                </th>
            </tr>
        </thead>
        <tbody>
            @{
                if (Model != null)
                {
                    var dt = Model as DataTable;
                    if (dt.Rows.Count > 0)
                    {
                        int i = 0;
                        foreach (DataRow item in dt.Rows)
                        {

                            <tr id="Row_@i">
                                <td class="text-left">
                                    @item["Region"]
                                </td>
                                <td class="text-left">
                                    @item["City"]
                                </td>
                                <td class="text-left">
                                    @item["Location Code"]
                                </td>
                                <td class="text-left">
                                    @item["No_"]
                                </td>
                                <td class="text-left">
                                    @item["Order Date"]
                                </td>
                                <td class="text-right">
                                    @item["TotalOrderQtty"]
                                </td>
                                <td class="text-right">
                                    @item["TotalSLGiao"]
                                </td>
                                <td class="text-right">
                                    @item["TongSLDaGiaoHang"]
                                </td>
                                <td class="text-right">
                                    @if (item["StatusDaGiaoHang"].ToString() != "0")
                                    {
                                        @item["SLChenhLech"]
                                        <div class="SLChenhLech" style=" display:none">@item["SLChenhLech"].ToString().Replace(",", "")</div>
                                    }
                                    else
                                    {
                                        @item["SLChenhLech2"]
                                        <div class="SLChenhLech" style=" display:none">@item["SLChenhLech2"].ToString().Replace(",", "")</div>
                                    }
                                </td>
                                <td class="text-right">
                                    @item["TongTien"]
                                </td>
                                <td class="text-right">
                                    @item["TotalOrdersVolume"]
                                </td>
                                <td class="text-center">
                                    <a href="/Order/Detail?id=@item["No_"]" class="label label-info">Xem</a>
                                </td>
                                <td class="text-center">
                                    @if (item["StatusDaGiaoHang"].ToString() != "0")
                                    {
                                        <span class="label label-success " style="padding-right: 22px; padding-left: 22px;">Đã giao hàng</span>
                                    }
                                    else
                                    {
                                        if (@item["isStatus"].ToString() == "1")
                                        {
                                            <span class="label label-info"> @item["Status"]</span>
                                        }
                                        else if (@item["isStatus"].ToString() == "3")
                                        {
                                            <span class="label label-default"> @item["Status"]</span>
                                        }
                                        else
                                        {
                                            <span class="label label-warning"> @item["Status"]</span>
                                        }
                                    }
                                </td>
                            </tr>
                            i++;
                        }
                    }
                }
            }
        </tbody>
        <tfoot>
            @{
                if (Model != null)
                {
                    var dt = Model as DataTable;
                    if (dt.Rows.Count > 0)
                    {
                        <tr style="background: #ffffff; border-bottom: 1px solid #ddd !important; border-top: 1px solid #fff; border-left: 1px solid #fff; border-right: 1px solid #fff !important;">
                            <th class="text-left" style="border: none !important;"></th>
                            <th class="text-left" style="border: none !important;"></th>
                            <th class="text-left" style="border: none !important;"></th>
                            <th class="text-left" style="border: none !important;"></th>
                            <th class="text-left" style="border: none !important;"></th>
                            <th class="text-right" style="border: none !important;">
                                @ViewBag.TotalOrderQtty
                            </th>
                            <th class="text-right" style="border: none !important;">
                                @ViewBag.TotalSLGiao
                            </th>
                            <th class="text-right" style="border: none !important;">  @ViewBag.TotalTongSLDaGiaoHang</th>
                            <th class="text-right" style="border: none !important;">
                                <span id="SumChenhLechs"></span>
                            </th>
                            <th class="text-right" style="border: none !important;">
                                @ViewBag.sumTongTien
                            </th>
                            <th class="text-right" style="border: none !important;">
                                @ViewBag.TotalOrdersVolume
                            </th>
                            <th class="text-left" style="border: none !important;">
                            </th>
                            <th class="text-left" style="border: none !important;"></th>
                        </tr>
                    }
                }
            }
        </tfoot>
    </table>
</div>
<script>
    $(function () {
        SumChenhlech();
    });
    function SumChenhlech() {
        var SumSLChenhLech = 0;
        let trs = $("#tbl_Item tbody tr");
        if (trs.length) {
            trs.each((index, tr) => {
                let SLChenhLech = $('#' + tr.id + ' .SLChenhLech').html();
                if (SLChenhLech.length > 0) {
                    SumSLChenhLech += parseInt(SLChenhLech);
                }
            });
        }
        $('#SumChenhLechs').html(commaSeparateNumber(SumSLChenhLech));
    }
    function commaSeparateNumber(val) {
        while (/(\d+)(\d{3})/.test(val.toString())) {
            val = val.toString().replace(/(\d+)(\d{3})/, '$1' + ',' + '$2');
        }
        return val;
    }
</script>


<style>
    .badge-success, .label-success {
        padding-right: 15px !important;
        padding-left: 15px !important;
    }
</style>